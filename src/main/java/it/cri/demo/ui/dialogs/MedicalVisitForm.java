package it.cri.demo.ui.dialogs;

import com.jgoodies.forms.layout.CellConstraints;
import com.jgoodies.forms.layout.FormLayout;
import it.cri.demo.entity.MedicalVisit;
import it.cri.demo.entity.Volunteer;
import it.cri.demo.service.VolunteerService;

import javax.swing.*;
import javax.swing.text.MaskFormatter;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.text.ParseException;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;

public class MedicalVisitForm extends JDialog {
    private JPanel mainPanel;
    private JFormattedTextField dateFormattedField;
    private JTextField doctorField;
    private JLabel dateLabel;
    private JLabel doctorLabel;
    private JButton insertButton;
    private JButton cancelButton;
    private JSeparator separator;

    private Volunteer volunteer;
    private VolunteerService volunteerService;

    public MedicalVisitForm(Frame owner, Volunteer volunteer, VolunteerService volunteerService) {
        super(owner, "Inserisci visita medica", true);
        $$$setupUI$$$();
        setContentPane(mainPanel);
        setSize(160, 300);
        setDefaultCloseOperation(DISPOSE_ON_CLOSE);

        this.volunteer = volunteer;
        this.volunteerService = volunteerService;

        cancelButton.addActionListener(e -> dispose());
        insertButton.addActionListener(e -> confirmSave());
    }

    private void confirmSave() {
        //TODO: dateFormattedField.getText() or dateFormattedField.getValue()?
        LocalDate date = LocalDate.parse(dateFormattedField.getText(), DateTimeFormatter.ofPattern("dd/MM/yyyy"));
        String doctor = doctorField.getText();

        MedicalVisit m = new MedicalVisit();
        m.setDate(date);
        m.setDoctor(doctor);
        m.setVolunteer(this.volunteer);

        this.volunteer.getMedicalVisits().add(m);
        this.volunteerService.save(this.volunteer);
    }

    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        createUIComponents();
        mainPanel = new JPanel();
        mainPanel.setLayout(new FormLayout("fill:max(d;4px):grow,fill:max(d;4px):grow", "fill:max(d;4px):noGrow,center:max(d;4px):noGrow,fill:max(d;4px):noGrow,center:max(d;4px):noGrow,fill:d:grow,center:max(d;4px):noGrow"));
        dateFormattedField.setPreferredSize(new Dimension(160, 30));
        CellConstraints cc = new CellConstraints();
        mainPanel.add(dateFormattedField, cc.xyw(1, 2, 2, CellConstraints.FILL, CellConstraints.DEFAULT));
        dateLabel = new JLabel();
        dateLabel.setPreferredSize(new Dimension(160, 17));
        dateLabel.setText("Data");
        mainPanel.add(dateLabel, cc.xyw(1, 1, 2));
        doctorField = new JTextField();
        doctorField.setPreferredSize(new Dimension(160, 30));
        mainPanel.add(doctorField, cc.xyw(1, 4, 2, CellConstraints.FILL, CellConstraints.DEFAULT));
        doctorLabel = new JLabel();
        doctorLabel.setPreferredSize(new Dimension(160, 17));
        doctorLabel.setText("Dottore");
        mainPanel.add(doctorLabel, cc.xyw(1, 3, 2));
        separator = new JSeparator();
        mainPanel.add(separator, cc.xyw(1, 5, 2, CellConstraints.FILL, CellConstraints.FILL));
        insertButton = new JButton();
        insertButton.setPreferredSize(new Dimension(80, 30));
        insertButton.setText("Inserisci");
        mainPanel.add(insertButton, cc.xy(1, 6));
        cancelButton = new JButton();
        cancelButton.setText("Annulla");
        mainPanel.add(cancelButton, cc.xy(2, 6));
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return mainPanel;
    }

    private void createUIComponents() {
        // TODO: place custom component creation code here
        MaskFormatter dateFormatter = null;
        try {
            dateFormatter = new MaskFormatter("##/##/####");
        } catch (ParseException e) {
            throw new RuntimeException(e);
        }
        dateFormatter.setPlaceholderCharacter('_');

        dateFormattedField = new JFormattedTextField(dateFormatter);
        dateFormattedField.setColumns(10);
    }
}
